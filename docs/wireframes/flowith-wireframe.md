## Canvas / Chat Node Wireframeï¼ˆFlowith é£æ ¼ Â· MVPï¼‰

å‚è€ƒï¼š`prd.md`ã€`docs/ui-architecture.md`ï¼Œä»¥åŠæˆªå›¾ `canvas1.png`ã€`canvas2.png`ï¼ˆè§ `.cursor/task/`ï¼‰ã€‚æœ¬æ–‡ä»¶ç”¨äºæŒ‡å¯¼ Figma ç»„ä»¶æ­å»ºä¸å‰ç«¯å®ç°çš„ä½ä¿çœŸå¸ƒå±€ä¸äº¤äº’è§„èŒƒã€‚

---

### è®¾è®¡ Tokensï¼ˆä¾› Figma å˜é‡ä¸ä»£ç å…±ç”¨ï¼‰

- åŸºå‡†æ …æ ¼ï¼š8pxï¼Œç”»å¸ƒç½‘æ ¼ 16px é—´è·ã€1px çº¿ï¼Œ10% é€æ˜åº¦
- åœ†è§’ï¼šxs=6ã€sm=8ã€md=12ï¼ˆèŠ‚ç‚¹å¤–æ¡†ï¼‰ã€lg=16
- é˜´å½±ï¼še1=0 1 2 rgba(0,0,0,0.05)ã€e2=0 4 12 rgba(0,0,0,0.08)
- é¢œè‰²ï¼ˆå‘½åç¤ºä¾‹ï¼‰ï¼š
  - Layer/Background: `--bg: #0B0C0F`ï¼ˆæš—ï¼‰/ `#F7F8FA`ï¼ˆäº®ï¼‰
  - Layer/Surface: `--surface: #111318`ï¼ˆæš—ï¼‰/ `#FFFFFF`ï¼ˆäº®ï¼‰
  - Border/Default: `--border: #2A2E37`
  - Brand/Primary: `--primary: #6E6BFF`
  - Info/Running: `--running: #7AA2F7`
  - Success: `--success: #22C55E`
  - Error: `--error: #F43F5E`

---

### ç”»å¸ƒå¸ƒå±€ï¼ˆAppShell â†’ CanvasPageï¼‰

- é¡¶éƒ¨æ  TopBarï¼šé«˜åº¦ 56ï¼Œå·¦å³å†…è¾¹è· 16/24ï¼ˆsm/md+ï¼‰ï¼Œå†…å®¹ï¼šé¡¹ç›®åã€ä¿å­˜çŠ¶æ€ã€å¯¼å‡ºã€è®¾ç½®
- å·¦ä¾§å·¥å…·æ  LeftToolbarï¼šå®½ 56ï¼ˆicon 24ï¼‰ï¼Œå«ï¼šæ–°å»ºèŠ‚ç‚¹ã€è¿çº¿æç¤ºã€æ’¤é”€é‡åš
- å³ä¾§å±æ€§é¢æ¿ RightPanelï¼šé»˜è®¤æ”¶èµ·ï¼Œå±•å¼€å®½ 280ï¼Œæ˜¾ç¤ºé€‰ä¸­èŠ‚ç‚¹å±æ€§ï¼ˆæ ‡é¢˜ã€æ¨¡å‹ã€å‚æ•°ï¼‰
- ä¸»ç”»å¸ƒ ReactFlowï¼šå……æ»¡å‰©ä½™ç©ºé—´ï¼›ç½‘æ ¼èƒŒæ™¯ï¼›å¸é™„å¼€å¯ï¼›ç¼©æ”¾èŒƒå›´ 10%â€“400%
- è¿·ä½ åœ°å›¾/æ§åˆ¶ï¼ˆP1ï¼‰ï¼šå³ä¸‹è§’æ‚¬æµ®ï¼›ä¸ Flowith é£æ ¼è´´è¾¹åœ†è§’å¡ç‰‡

ä½ä¿çœŸç¤ºæ„ï¼ˆéæ¯”ä¾‹ï¼‰ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TopBar (56)    Project â€¢ Saved â¬¤      Export  Settings (âš™)              â”‚
â”œâ”€â”€â•´LeftToolbar(56)â•¶â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Canvas / ReactFlow â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢  New Node                                                             â”‚
â”‚  â€¢  Connect hint                                                         â”‚
â”‚  â€¢  Undo / Redo                                                          â”‚
â”‚                                                                          â”‚
â”‚   [ChatNode M]           [ChatNode M  running]       [ChatNode S]        â”‚
â”‚        â†˜â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’        â†˜â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’                          â”‚
â”‚                                                                          â”‚
â”‚                                                     MiniMap (P1)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Chat èŠ‚ç‚¹ç»“æ„ï¼ˆNodeType: `chat`ï¼‰

- å¤–æ¡†ï¼šåœ†è§’ md=12ã€1px è¾¹æ¡†ï¼›é»˜è®¤ e1 é˜´å½±ï¼›é€‰ä¸­æ—¶è¾¹æ¡† 2px `--primary`
- å°ºå¯¸ï¼ˆå¯æ‹–æ‹½ï¼‰ï¼š
  - S: 320 Ã— 260 ï¼›M: 420 Ã— 320ï¼ˆé»˜è®¤ï¼‰ï¼›L: 560 Ã— 420
- Headerï¼ˆ48 é«˜ï¼‰ï¼š
  - å·¦ï¼šæ ‡é¢˜ï¼ˆå¯ç¼–è¾‘ï¼Œå•è¡Œçœç•¥ï¼‰
  - ä¸­ï¼šæ¨¡å‹å¾½ç« ï¼ˆå¦‚ `gpt-4o`ï¼‰
  - å³ï¼šæ“ä½œæŒ‰é’®ç»„ï¼ˆRun/Stopã€Duplicateã€Deleteã€Moreï¼‰ã€‚é—´è· 8
- Body å†…å®¹åŒºï¼ˆè‡ªé€‚åº”é«˜åº¦ï¼Œå¯æ»šåŠ¨ï¼‰ï¼š
  - ç©ºæ€ï¼šæç¤ºâ€œç¼–è¾‘æç¤ºè¯å¹¶è¿è¡Œï¼Œæˆ–è¿æ¥ä¸Šæ¸¸èŠ‚ç‚¹â€
  - æ¶ˆæ¯ï¼šå¡ç‰‡æˆ–æ°”æ³¡ï¼ˆP1 Markdown æ¸²æŸ“ï¼‰
- Footerï¼ˆ56 é«˜ï¼Œå¯æŠ˜å ï¼‰ï¼š
  - å¤šè¡Œæ–‡æœ¬æ¡†ï¼ˆæç¤ºè¯/è¿½é—®ï¼‰ï¼Œ`âŒ˜/Ctrl+Enter` è¿è¡Œï¼›æŒ‰é’®ï¼šRunï¼ˆä¸»è¦ï¼‰/ Stopï¼ˆè¿è¡Œæ—¶ï¼‰
- ç«¯å£ï¼ˆPortsï¼‰ï¼š
  - å…¥ç«¯å£ï¼šå·¦ä¾§ä¸­çº¿ä½ç½®ï¼Œå¯å¤šæ¡è¿æ¥
  - å‡ºç«¯å£ï¼šå³ä¾§ä¸­çº¿ä½ç½®ï¼Œå•æ¡å‘å¤–
  - çŠ¶æ€ï¼šdefault / hover / connectedï¼›å‘½ä¸­çƒ­åŒº 16Ã—16
  - å¯è¾¾æ€§ï¼šç«¯å£ 24Ã—24 çš„å¯ç‚¹å‡»å¤–ç¯ï¼Œè¾…åŠ©çº¿å¯¹é½æç¤º

èŠ‚ç‚¹çŠ¶æ€ä¸å¯è§†æ ·å¼ï¼š

- idleï¼šè¾¹æ¡† `--border`ï¼ŒRun æŒ‰é’®å¯ç”¨
- runningï¼šé¡¶éƒ¨å‡ºç° 2px è¿›åº¦æ¡ï¼ˆ`--running` æ¸å˜ï¼‰ï¼Œå…‰æ™•åŠ¨ç”»ï¼›Stop å¯ç”¨
- successï¼šè¾¹æ¡† `--success`ï¼ˆæµ…ï¼‰ï¼Œæ˜¾ç¤ºæœ€è¿‘ä¸€æ¬¡è€—æ—¶/æ¨¡å‹ tooltip
- errorï¼šé¡¶ç«¯é”™è¯¯æ¡ï¼Œ`--error` èƒŒæ™¯ä¸è¯´æ˜ï¼›æä¾› Retry æŒ‰é’®
- selected/focused/draggingï¼šå¤–æ¡†æè¾¹ + è½»å¾®æå‡é˜´å½± e2
  - resizingï¼šæ˜¾ç¤ºå››è§’ä¸è¾¹ä¸­ç‚¹æ‰‹æŸ„ï¼›æœ€å°å°ºå¯¸ S ä¸å¯å†ç¼©å°

ASCII ç»“æ„ï¼š

```text
â”Œâ”€ Header (48) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Title       [ModelBadge]                       âµ â˜ ğŸ—‘ â‹¯   â”‚
â”œâ”€ Body (auto, scroll) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ Messages / Empty state                                 â”‚
â”œâ”€ Footer (56) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [  Prompt textarea ...                    ]   Run / Stop  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â—‰ in                                        out â—‰
```

---

### å…³é”®äº¤äº’ï¼ˆMVPï¼‰

- æ–°å»ºèŠ‚ç‚¹ï¼šå·¦æ æŒ‰é’®æˆ–å¿«æ·é”® `N` â†’ åœ¨è§†çª—ä¸­å¿ƒæ”¾ç½® `ChatNode M`
- æ‹–æ‹½ä¸ç¼©æ”¾ï¼šç©ºæ ¼/ä¸­é”®å¹³ç§»ï¼›æ»šè½®ç¼©æ”¾ï¼›å¸é™„å¯¹é½çº¿å‡ºç°æ—¶ç£å¸
- è¿çº¿ï¼šä»å‡ºç«¯å£æ‹–åˆ°ç›®æ ‡å…¥ç«¯å£ï¼›å¾ªç¯è¿æ¥é˜»æ­¢å¹¶æç¤º
- è¿è¡Œï¼šèŠ‚ç‚¹å†… `âŒ˜/Ctrl + Enter` æˆ–ç‚¹å‡» Runï¼›è¿è¡Œä¸­å¯ Stopï¼›å¤±è´¥æ˜¾ç¤ºé”™è¯¯å¹¶å¯ Retry
- å¤åˆ¶/åˆ é™¤ï¼š`âŒ˜/Ctrl + D` å¤åˆ¶ï¼Œ`Delete` åˆ é™¤
- ä¿å­˜/æ‰“å¼€ï¼šå…¨å±€å±‚é¢ï¼›å¯¼å‡º PNGï¼ˆP0ï¼‰ï¼ŒMarkdown/JSONï¼ˆP1ï¼‰
- æ¡†é€‰/å¤šé€‰ï¼ˆP1ï¼‰ï¼šæŒ‰ä½ `Shift` æ‹–æ‹½å‡ºç°é€‰æ‹©æ¡†ï¼›ç§»åŠ¨ä¿æŒç›¸å¯¹ä½ç½®
- è¿·ä½ åœ°å›¾ï¼ˆP1ï¼‰ï¼šç‚¹å‡»è·³è½¬ï¼›æ»šè½®ç¼©æ”¾åŒæ­¥

å¿«æ·é”®æ€»è§ˆï¼ˆä¸ `docs/ui-architecture.md` å¯¹é½ï¼‰ï¼š

- `N` æ–°å»ºèŠ‚ç‚¹ï¼›`âŒ˜/Ctrl + Enter` è¿è¡Œï¼›`âŒ˜/Ctrl + D` å¤åˆ¶ï¼›`Delete` åˆ é™¤
- `âŒ˜/Ctrl + Z` æ’¤é”€ï¼›`âŒ˜/Ctrl + Shift + Z` é‡åš

---

### Figma ç»„ä»¶ç»“æ„ä¸å‘½å

- åº“åï¼š`Canvas System`ï¼ˆå»ºè®®å‘å¸ƒä¸ºå›¢é˜Ÿåº“ï¼‰
- ç»„ä»¶ï¼š
  - `TopBar`ï¼ˆvariant: density[comfortable/compact]ï¼‰
  - `LeftToolbar`ï¼ˆitems å¯äº¤æ¢ï¼‰
  - `RightPanel`ï¼ˆvariant: open[true/false]ï¼‰
  - `ReactFlowCanvas`ï¼ˆç½‘æ ¼èƒŒæ™¯ä½œä¸ºæ ·å¼ï¼‰
  - `ChatNode`ï¼ˆæ ¸å¿ƒï¼‰
    - variantsï¼š
      - size[S/M/L]ï¼›status[idle/running/success/error]
      - selected[true/false]ï¼›focused[true/false]
      - footer[visible/hidden]
    - éƒ¨ä»¶ï¼š`Header`, `Body`, `Footer`, `PortIn`, `PortOut`, `Actions`
  - `Port`ï¼ˆç‹¬ç«‹åŸå­ç»„ä»¶ï¼‰ï¼štype[in/out]ã€state[default/hover/connected]
  - `Edge`ï¼ˆæ ·å¼è§„æ ¼ç»„ä»¶ï¼‰ï¼šæ›²çº¿ã€ç®­å¤´ã€hover åŠ ç²—
  - `MiniMap`ï¼ˆP1ï¼‰ï¼švariant: visible[true/false]
  - `Toast`ï¼šçŠ¶æ€ info/success/error
- æ ·å¼å˜é‡ï¼šé¢œè‰²ã€åœ†è§’ã€é˜´å½±ã€é—´è·ï¼ˆé‡‡ç”¨ä¸Šæ–‡ Tokens åç§°ï¼‰
- ç¤ºä¾‹å›¾å±‚å‘½åï¼š`ChatNode/size=M,status=running,selected=true`

ç»„è£…å…³ç³»ï¼ˆä¸ä»£ç æ˜ å°„ï¼‰ï¼š

```text
ChatNode (component)
  â”œâ”€ Header â†’ React: <NodeHeader />
  â”œâ”€ Body   â†’ React: <NodeBody />
  â”œâ”€ Footer â†’ React: <NodePrompt />
  â”œâ”€ PortIn / PortOut â†’ React Flow Handles
  â””â”€ Actions â†’ Run/Stop, Duplicate, Delete
```

---

### ä¸å‰ç«¯å®ç°çš„å¯¹ç…§ï¼ˆå…³é”® propsï¼‰

```ts
// ChatNode propsï¼ˆå»ºè®®ï¼‰
export interface ChatNodeProps {
  id: string
  title: string
  modelId: string
  status: 'idle' | 'running' | 'error' | 'success'
  messagesCount: number
  prompt: string
  onChangeTitle(value: string): void
  onChangePrompt(value: string): void
  onRun(): void
  onStop(): void
  onDuplicate(): void
  onDelete(): void
}
```

---

### å¯è®¿é—®æ€§ï¼ˆA11yï¼‰

- èŠ‚ç‚¹å¤–æ¡†å¯èšç„¦ï¼ˆ`tabindex=0`ï¼‰ï¼Œ`aria-label="Chat node: {title}"`
- æ“ä½œæŒ‰é’®å…·å `aria-label`ï¼›Run/Stop ä½¿ç”¨ `aria-pressed` è¡¨ç¤ºåˆ‡æ¢
- ç«¯å£å…·å¤‡å¯è§†ä¸æ–‡æœ¬æç¤ºï¼š`aria-label="output port" / "input port"`
- é”®ç›˜ï¼šæ–¹å‘é”®ç§»åŠ¨ç„¦ç‚¹ï¼›`Enter` æ‰“å¼€æ ‡é¢˜ç¼–è¾‘ï¼›`Esc` é€€å‡º
- å¯¹æ¯”åº¦ï¼šéµå¾ª WCAG AAï¼Œé”™è¯¯/æˆåŠŸçŠ¶æ€é¢œè‰²æ»¡è¶³æ–‡æœ¬å¯¹æ¯”
- åŠ¨ç”»ä¸åŠ¨æ•ˆï¼šè¿è¡Œè¿›åº¦æ¡åŠ¨æ•ˆ < 3/ç§’ï¼›æä¾›â€œå‡å°‘åŠ¨æ•ˆâ€åª’ä½“æŸ¥è¯¢é€‚é…
- æ–‡æœ¬ç¼©æ”¾ï¼šå¸ƒå±€åœ¨ 200% æ”¾å¤§ä¸‹ä»å¯æ“ä½œï¼ˆæœ€å°å¯ç‚¹å‡» 24Ã—24ï¼‰
- å±å¹•é˜…è¯»é¡ºåºï¼šHeader â†’ Body â†’ Footer â†’ Portsï¼ˆé€»è¾‘é¡ºåºä¸è§†è§‰ä¸€è‡´ï¼‰

---

### äº¤ä»˜æŒ‡å¼•

1. åœ¨ Figma æ–°å»ºæ–‡ä»¶ã€ŠCanvas Systemã€‹å¹¶å»ºç«‹å˜é‡ï¼ˆé¢œè‰²/åœ†è§’/é˜´å½±/é—´è·ï¼‰
2. å…ˆæ­å»º `ChatNode` ç»„ä»¶ä¸å˜ä½“ï¼Œå†æ‹¼è£…ç”»å¸ƒæ¨¡æ¿ï¼ˆTopBar/LeftToolbar/Canvas/RightPanelï¼‰
3. ç”¨ `canvas1.png`/`canvas2.png` ä½œä¸ºè§†è§‰å‚è€ƒï¼Œä¿æŒç•™ç™½ã€åœ†è§’ä¸å¡ç‰‡å±‚çº§é£æ ¼
4. è¾“å‡ºé¡µé¢ï¼š
   - ç”»å¸ƒæ¨¡æ¿ï¼ˆDesktop 1440Ã—900ï¼‰
   - èŠ‚ç‚¹ç»„ä»¶é¢æ¿ï¼ˆå±•ç¤ºå…¨éƒ¨å˜ä½“ï¼‰
   - äº¤äº’æ³¨é‡Šé¡µï¼ˆæ ‡æ³¨å¿«æ·é”®ä¸çŠ¶æ€åˆ‡æ¢ï¼‰
5. Figma å¯¼å…¥ä¸å‚è€ƒï¼šè§ `docs/figma/README.md`ã€`docs/figma/components.md`ã€`docs/figma/tokens.json`ï¼›é«˜ä¿çœŸç¤ºä¾‹ `docs/figma/hifi-example.svg`

---

### é™„å½•ï¼šèŠ‚ç‚¹çŠ¶æ€ç¤ºæ„ï¼ˆä½ä¿çœŸï¼‰

```text
Idle:     â”Œ Node â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Title [model]        â–· â˜ ğŸ—‘ â‹¯   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Running:  â”Œ Node â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚â–”â–”â–”â–” progress bar â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”â–”  â”‚
          â”‚  Title [model]        â–  â˜ ğŸ—‘ â‹¯   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Error:    â”Œ Node â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Error â€¢ Rate limit. Retry        â”‚
          â”‚  Title [model]        â–· â˜ ğŸ—‘ â‹¯   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
